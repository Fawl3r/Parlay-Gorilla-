# ===========================================
# Parlay Gorilla Backend Configuration
# ===========================================

# Environment
ENVIRONMENT=development
DEBUG=true

# ===========================================
# Database Configuration
# ===========================================

# IMPORTANT: For Render deployment, use Render PostgreSQL.
# Get your connection string from: Render dashboard → PostgreSQL → Internal Database URL
#
# Examples (all supported):
# DATABASE_URL=postgresql://user:password@dpg-xxx-a.oregon-postgres.render.com/parlaygorilla
# DATABASE_URL=postgres://user:password@dpg-xxx-a.oregon-postgres.render.com/parlaygorilla
# DATABASE_URL=postgresql+asyncpg://user:password@dpg-xxx-a.oregon-postgres.render.com/parlaygorilla
#
# Local development (Docker/Local Postgres):
# DATABASE_URL=postgresql://devuser:devpass@localhost:5432/parlaygorilla

# SQLite fallback (DISABLE for Render - set to false)
USE_SQLITE=false

# Redis (distributed cache + scheduler leader election)
# REQUIRED in production (ENVIRONMENT=production) to prevent Odds API credit drain across instances.
REDIS_URL=redis://localhost:6379
# Or use remote Redis / Render Key Value internal URL:
# redis://red-xxxxxxxxxxxxxxxxxxxx:6379

# ===========================================
# External API Keys
# ===========================================

THE_ODDS_API_KEY=your_odds_api_key_here
# Optional: secondary key used if the primary key hits an outage/quota issue.
THE_ODDS_API_FALLBACK_KEY=
# Disable OpenAI for offline/CI test runs (the API will return fast fallbacks).
OPENAI_ENABLED=true
OPENAI_API_KEY=your_openai_api_key_here
# Optional: SportsRadar (stats/injuries/schedules).
# Trial keys are heavily rate-limited; if you see repeated 429s in local dev,
# leave this blank to rely on ESPN fallbacks instead.
SPORTSRADAR_API_KEY=
OPENWEATHER_API_KEY=your_openweather_api_key_here
GETTY_IMAGES_API_KEY=
GETTY_IMAGES_API_SECRET=
PEXELS_API_KEY=
UNSPLASH_ACCESS_KEY=

# ===========================================
# Application URLs
# ===========================================

BACKEND_URL=http://localhost:8000
FRONTEND_URL=http://localhost:3000
APP_URL=http://localhost:3000

# ===========================================
# Email (Resend) - Verification + Password Reset
# ===========================================
#
# NOTE:
# - RESEND_API_KEY is required for users to actually receive emails.
# - RESEND_FROM must be either:
#   - a Resend-provided sender like onboarding@resend.dev (works without domain verification), OR
#   - an address on a domain you've verified in Resend (recommended for production branding).
#
RESEND_API_KEY=
RESEND_FROM=Parlay Gorilla <onboarding@resend.dev>

# Optional: public logo URL to use in transactional emails (verification/reset).
# If unset, emails will use {APP_URL}/images/newlogo.png.
# IMPORTANT: This must be publicly reachable by recipients (avoid localhost); HTTPS is strongly recommended.
EMAIL_LOGO_URL=

# ===========================================
# Security
# ===========================================

JWT_SECRET=change-this-to-a-random-secret-in-production
JWT_ALGORITHM=HS256
JWT_EXPIRATION_HOURS=24

# Rate Limiting
# WARNING: Only set DISABLE_RATE_LIMITS=true for testing. NEVER enable in production!
# DISABLE_RATE_LIMITS=false

# ===========================================
# Background Jobs
# ===========================================

ENABLE_BACKGROUND_JOBS=true
SCRAPER_INTERVAL_MINUTES=30
ODDS_SYNC_INTERVAL_MINUTES=2880

# ===========================================
# Web Push Notifications (optional)
# ===========================================
#
# Enables opt-in Web Push notifications (browser notifications) for new game analyses.
# NOTE: Web Push requires HTTPS in production (localhost works for dev).
#
# Generate VAPID keys (example using npx):
#   npx web-push generate-vapid-keys
#
# Or generate using Python tooling of your choice, then set:
WEB_PUSH_ENABLED=false
WEB_PUSH_VAPID_PUBLIC_KEY=
WEB_PUSH_VAPID_PRIVATE_KEY=
# RFC 8292 subject (mailto: or https://)
WEB_PUSH_SUBJECT=mailto:support@parlaygorilla.com

# ===========================================
# App Metadata
# ===========================================
#
# Used in deterministic hashing payloads for verification records.
#
APP_VERSION=pg_backend_v1

# ===========================================
# Automatic Custom Parlay Verification (Sui)
# ===========================================
#
# Automatic verification creates immutable proof objects for every Custom AI parlay.
# Verification is automatic, server-side, and idempotent (no user action required).
#
ENABLE_CUSTOM_PARLAY_VERIFICATION=true
# Sui RPC endpoint (mainnet)
SUI_RPC_URL=https://fullnode.mainnet.sui.io
# Sui package ID (from published Move module)
SUI_PACKAGE_ID=0xYOUR_PACKAGE_ID
# Server-only private key (NEVER expose to frontend)
SUI_PRIVATE_KEY=suiprivkey1...
# Service address (derived from private key)
SUI_ADDRESS=0xSERVICE_ADDRESS

# ===========================================
# Rate Limiting
# ===========================================

RATE_LIMIT_REQUESTS=100
RATE_LIMIT_PERIOD=60

# ===========================================
# Probability Engine Performance Tuning
# ===========================================
#
# These settings bound network work done during parlay generation and analysis
# probability calculations (team stats, injuries, weather, etc.).
#
# Tip for CI / offline runs:
# - Set PROBABILITY_EXTERNAL_FETCH_ENABLED=false and PROBABILITY_PREFETCH_ENABLED=false
#   to avoid slow external calls and make test runs deterministic.
#
PROBABILITY_EXTERNAL_FETCH_ENABLED=true
PROBABILITY_EXTERNAL_FETCH_TIMEOUT_SECONDS=2.5
PROBABILITY_PREFETCH_ENABLED=true
PROBABILITY_PREFETCH_CONCURRENCY=8
PROBABILITY_PREFETCH_MAX_GAMES=50
# Hard cap for the whole prefetch phase (seconds). 0 disables the cap.
PROBABILITY_PREFETCH_TOTAL_TIMEOUT_SECONDS=12.0

# Analysis probability refresh timeout (seconds).
# The analysis detail endpoint may attempt to refresh stale probabilities; this
# hard cap ensures pages never hang due to slow refresh work.
ANALYSIS_PROBABILITY_REFRESH_TIMEOUT_SECONDS=8.0

# Analysis generation (core + full article)
# - Core analysis is generated fast and returned immediately.
# - Full article is generated in background (best-effort) and persisted when ready.
ANALYSIS_CORE_TIMEOUT_SECONDS=8.0
ANALYSIS_CORE_AI_POLISH_TIMEOUT_SECONDS=4.0
ANALYSIS_FULL_ARTICLE_ENABLED=true
ANALYSIS_FULL_ARTICLE_TIMEOUT_SECONDS=90.0
# Analysis cache TTL (hours)
# - NFL default: 48 hours
# - Non-NFL default: 24 hours (more frequent games)
ANALYSIS_CACHE_TTL_HOURS=48
ANALYSIS_CACHE_TTL_HOURS_NON_NFL=24

# ===========================================
# Payments (Subscriptions + Credit Packs)
# ===========================================
#
# Webhook endpoints (configure these in provider dashboards):
# - Stripe: POST {BACKEND_URL}/api/webhooks/stripe
#
# Redirect URLs use APP_URL (frontend), e.g.:
# - {APP_URL}/billing/success?provider=stripe

# Stripe (card payments - subscriptions and one-time)
STRIPE_SECRET_KEY=
STRIPE_WEBHOOK_SECRET=

# Stripe Price IDs (subscription plans)
# These map to SubscriptionPlan.code values for provider="stripe".
# Used as a fallback when subscription_plans.provider_product_id is not set.
# - PG_PRO_MONTHLY
# - PG_PRO_ANNUAL
STRIPE_PRICE_ID_PRO_MONTHLY=
STRIPE_PRICE_ID_PRO_ANNUAL=

# Stripe success/cancel URLs for checkout redirects
# These use {app_url} placeholder which will be replaced with APP_URL
STRIPE_SUCCESS_URL={app_url}/billing/success?provider=stripe
STRIPE_CANCEL_URL={app_url}/billing?canceled=true

# Coinbase Commerce (crypto payments) - DEPRECATED
# Disabled for LemonSqueezy compliance. Kept for reference only.
# Do not re-enable without compliance review.
# COINBASE_COMMERCE_API_KEY=
# COINBASE_COMMERCE_WEBHOOK_SECRET=

# ===========================================
# Usage Limits & Credit Costs
# ===========================================
#
# Premium limits (rolling 30-day period for AI parlays; daily for custom builder)
# PREMIUM_AI_PARLAYS_PER_MONTH=200
# PREMIUM_AI_PARLAYS_PERIOD_DAYS=30
# PREMIUM_CUSTOM_PARLAYS_PER_DAY=25
#
# Credits are spent per usage (10 credits per AI action by default)
# CREDITS_COST_AI_PARLAY=10
# CREDITS_COST_CUSTOM_BUILDER_ACTION=10
# Credits cost for premium inscription overage (after included quota is exhausted)
# CREDITS_COST_INSCRIPTION=1

# ===========================================
# Affiliate Payouts (PayPal + Crypto)
# ===========================================
#
# These power affiliate commission payouts AND tax ledger tracking.
# Admin routes:
# - /api/admin/payouts/*
# - /api/admin/tax/*
#

# PayPal Payouts API (affiliate payouts)
PAYPAL_CLIENT_ID=
PAYPAL_CLIENT_SECRET=
# Minimum payout threshold (USD)
PAYPAL_PAYOUT_MINIMUM=25.00

# Circle API (USDC crypto payouts)
CIRCLE_API_KEY=
# sandbox | production
CIRCLE_ENVIRONMENT=sandbox

# Tax valuation snapshotting (for crypto FMV at payout time)
# If enabled, attempts to fetch a live quote (Coinbase spot) for the asset.
TAX_VALUATION_EXTERNAL_ENABLED=true
TAX_VALUATION_TIMEOUT_SECONDS=3.0

